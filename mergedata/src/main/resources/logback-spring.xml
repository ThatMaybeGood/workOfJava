<?xml version="1.0" encoding="UTF-8"?>
<configuration>

    <conversionRule conversionWord="clr" converterClass="org.springframework.boot.logging.logback.ColorConverter" />
    <conversionRule conversionWord="wex" converterClass="org.springframework.boot.logging.logback.WhitespaceThrowableProxyConverter" />
    <conversionRule conversionWord="cn" converterClass="org.springframework.boot.logging.logback.CallerDataConverter" />

    <springProperty scope="context" name="LOG_PATH" source="logging.log-dir" defaultValue="log"/>
    <springProperty scope="context" name="MAX_FILE_SIZE" source="logging.max-file-size" defaultValue="50MB"/>
    <springProperty scope="context" name="MAX_HISTORY" source="logging.max-history-days" defaultValue="30"/>
    <springProperty scope="context" name="ROOT_LEVEL" source="logging.level.root" defaultValue="INFO"/>
    <springProperty scope="context" name="CONSOLE_PATTERN" source="logging.pattern.console" defaultValue="%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID}){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40c{1.}){cyan} %clr(:){faint} %m%n%wex"/>
    <springProperty scope="context" name="FILE_PATTERN" source="logging.pattern.file" defaultValue="%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level %c{1.} - %msg%n"/>

    <appender name="DAILY_SIZE_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">

        <file>${LOG_PATH}/application-active.log</file>

        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">

            <fileNamePattern>${LOG_PATH}/%d{yyyy-MM-dd}/%d{yyyy-MM-dd}.%i.log.gz</fileNamePattern>

            <maxFileSize>${MAX_FILE_SIZE}</maxFileSize>
            <maxHistory>${MAX_HISTORY}</maxHistory>
            <totalSizeCap>10GB</totalSizeCap>
        </rollingPolicy>

        <encoder>
            <pattern>${FILE_PATTERN}</pattern>
        </encoder>
    </appender>

    <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${CONSOLE_PATTERN}</pattern>
        </encoder>
    </appender>

    <springProfile name="default,dev,test">
        <root level="${ROOT_LEVEL}">
            <appender-ref ref="CONSOLE" />
        </root>
    </springProfile>

    <springProfile name="prod">
        <root level="${ROOT_LEVEL}">
            <appender-ref ref="DAILY_SIZE_FILE" />
        </root>
    </springProfile>

    <logger name="com.alibaba.druid" level="WARN"/>
    <logger name="com.zaxxer.hikari" level="WARN"/>
    <logger name="oracle.jdbc" level="WARN"/>

</configuration>